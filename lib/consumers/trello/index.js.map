{"version":3,"sources":["../../../src/consumers/trello/index.es6"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/*\nNOTE: This is a test\nTR_ID: 56f2859b245d2588a29740c5\nTR_STATUS: To Do\n*/\n\nimport path from 'path';\nimport R from 'ramda';\nimport Promise from 'bluebird';\nimport Trello from 'node-trello';\n\nimport TrelloFile from './trello-file';\nimport TrelloInbox from './trello-inbox';\nimport * as ENDPOINTS from './endpoints';\n\nlet mapInputFilesToTrelloFiles = function(files){\n\treturn files.map(function(file){\n\t\treturn new TrelloFile(file);\n\t});\n}\n\nlet filterBoardByName = R.curry(function(name, boards){\n\treturn boards.filter(function(board){\n\t\treturn board.name === name;\n\t});\n});\n\nlet getTrelloBoard = R.curry(function(trello, name){\n\n\tlet filterBoard = filterBoardByName(name);\n\n\treturn new Promise(function(resolve, reject){\n\t\ttrello.get(ENDPOINTS.BOARDS_URL, function(err, boards){\n\t\t\tif(err){\n\t\t\t\treject(err);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tlet board = filterBoard(boards);\n\n\t\t\t\tif(!board.length){\n\t\t\t\t\treject(new Error(`No board found with name ${name}`));\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tresolve(board[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n});\n\nlet getTrelloBoardLists = R.curry(function(trello, board){\n\tlet options = {\n\t\tcards:'open'\n\t};\n\n\treturn new Promise(function(resolve, reject){\n\t\ttrello.get(ENDPOINTS.LISTS_URL(board.id), options, function(err, data){\n\t\t\tif(err){\n\t\t\t\treject(err);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tresolve(data);\n\t\t\t}\n\t\t});\n\t})\n});\n\nlet processFilesWithLists = R.curry(function(files, lists){\n\treturn{\n\t\tfiles: files.map(function(file){\n\t\t\treturn file.process(lists);\n\t\t}),\n\t\tlists: lists\n\t}\n});\n\nlet postFilesToTrello = R.curry(function(trello, filesAndLists){\n\treturn Promise.map(filesAndLists.files, function(file){\n\t\treturn file.post(trello);\n\t})\n});\n\nlet processInboxWithFilepath = R.curry(function(filepath, filesAndLists){\n\tlet inbox = new TrelloInbox(filepath);\n\treturn inbox.process(filesAndLists.files, filesAndLists.lists);\n});\n\nexport default class DipestoConsumer{\n\tconstructor(key, token, boardName, inboxPath){\n\t\tthis.trello = new Trello(key, token);\n\t\tthis.boardName = boardName;\n\t\tthis.inboxPath = inboxPath || './inbox.trello';\n\t}\n\n\trun(_input){\n\t\tlet input = JSON.parse(_input),\n\t\t\tfiles = mapInputFilesToTrelloFiles(input.files);\n\n\t\tlet getBoard = getTrelloBoard(this.trello), // () -> Lists\n\t\t\tgetBoardLists = getTrelloBoardLists(this.trello), // (Lists) -> Lists\n\t\t\tprocessFiles = processFilesWithLists(files), // (Lists) -> Files\n\t\t\tpostFiles = postFilesToTrello(this.trello),\n\t\t\tprocessInbox = processInboxWithFilepath(this.inboxPath);\n\n\t\treturn R.pipeP(\n\t\t\tgetBoard,\n\t\t\tgetBoardLists,\n\t\t\tprocessFiles,\n\t\t\tfunction(filesAndLists){\n\t\t\t\treturn Promise.all([\n\t\t\t\t\tpostFiles(filesAndLists),\n\t\t\t\t\tprocessInbox(filesAndLists)\n\t\t\t\t]).then(function(results){\n\t\t\t\t\treturn{\n\t\t\t\t\t\tfiles: results[0],\n\t\t\t\t\t\tlists: results[1]\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tfunction(filesAndLists){\n\t\t\t\treturn filesAndLists.files.map(function(file){\n\t\t\t\t\tfile.writeToDisk();\n\t\t\t\t})\n\t\t\t},\n\t\t\tfunction(){\n\t\t\t\tconsole.log('ALL DONE');\n\t\t\t}\n\t\t)(this.boardName);\n\n\t}\n}\n"]}